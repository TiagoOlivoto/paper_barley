env_data_mean <- means_by(env_data_d, name)
ggplot(env_data_d, aes(x = value, y = env, fill = env)) +
geom_density_ridges(scale = 0.9) +
geom_vline(data = env_data_mean,
aes(xintercept = value),
linetype = 2) +
facet_grid(~name, scales = "free") +
theme(panel.grid.minor = element_blank(),
legend.position = "bottom",
legend.title = element_blank()) +
scale_y_discrete(expand = expansion(c(0, 0.05))) +
labs(x = "Observed value",
y = "Density",
fill = "") +
my_theme
ggsave("figs/fig2_density_climate.png", width = 12, height = 5)
# Chunk 9
names.window <- c('1-initial growing',
'2-Tillering',
'3-Boosting',
'4-Heading/Flowering',
"5-Grain filling",
"6-Physiological maturity")
out <-
env_typing(env.data = env_data,
env.id = "env",
var.id = c("trange", "tmax", "tmin", "dbp", "etp", "vpd"),
by.interval = TRUE,
time.window = c(0, 15, 35, 65, 90, 140),
names.window = names.window)
out2 <-
separate(out,
env.variable,
into = c("var", "freq"),
sep = "_",
extra = "drop")
# Chunk 10
# plot the distribution of envirotypes for dbp
p1 <-
out2 |>
subset(var == "tmin") |> # change the variable here
ggplot() +
geom_bar(aes(x=Freq, y=interval,fill=freq),
position = "fill",
stat = "identity",
width = 1,
color = "white",
size=.2)+
facet_grid(~env, scales = "free", space = "free")+
scale_y_discrete(expand = c(0,0))+
scale_x_continuous(expand = c(0,0))+
xlab('Relative frequency of the maximum temperature (ºC)')+
ylab("Crop stage")+
labs(fill='Envirotype')+
theme(axis.title = element_text(size=12),
legend.text = element_text(size=9),
strip.text = element_text(size=12),
legend.title = element_text(size=12),
strip.background = element_rect(fill="gray95",size=1),
legend.position = 'bottom')
# Chunk 11
# plot the distribution of envirotypes for dbp
p2 <-
out2 |>
subset(var == "vpd") |> # change the variable here
ggplot() +
geom_bar(aes(x=Freq, y=interval,fill=freq),
position = "fill",
stat = "identity",
width = 1,
color = "white",
size=.2)+
facet_grid(~env, scales = "free", space = "free")+
scale_y_discrete(expand = c(0,0))+
scale_x_continuous(expand = c(0,0))+
xlab(expression(Relative~frequency~of~the~vapor~pressure~deficit~~(KPa~day^{-1})))+
ylab("Environment")+
labs(fill='Envirotype')+
theme(axis.title = element_text(size=12),
legend.text = element_text(size=9),
strip.text = element_text(size=12),
legend.title = element_text(size=12),
strip.background = element_rect(fill="gray95",size=1),
legend.position = 'bottom')
# Chunk 12
# plot the distribution of envirotypes for dbp
p3 <-
out2 |>
subset(var == "dbp") |> # change the variable here
ggplot() +
geom_bar(aes(x=Freq, y=interval,fill=freq),
position = "fill",
stat = "identity",
width = 1,
color = "white",
size=.2)+
facet_grid(~env, scales = "free", space = "free")+
scale_y_discrete(expand = c(0,0))+
scale_x_continuous(expand = c(0,0))+
xlab(expression(Relative~frequency~of~the~rainfall~deficit~~(mm~day^{-1})))+
ylab("Environment")+
labs(fill='Envirotype')+
theme(axis.title = element_text(size=12),
legend.text = element_text(size=9),
strip.text = element_text(size=12),
legend.title = element_text(size=12),
strip.background = element_rect(fill="gray95",size=1),
legend.position = 'bottom')
arrange_ggplot(p1, p2, p3,
ncol = 1,
tag_levels = "a")
ggsave("figs/fig3_typology.png", width = 10, height = 9)
# Chunk 13
mod <-
gamem_met(df_traits,
env = ENV,
gen = GENOTYPES,
rep = REP,
block = IBLOCK,
resp = CAN:GY)
# Chunk 14
lrt <- gmd(mod, "lrt")
lrt
# Chunk 15
vcomp <- gmd(mod, "vcomp")
vcomp
p1 <- plot(mod, type = "vcomp")
p1
# Chunk 16
mod_env <-
gamem(df_traits,
gen = GENOTYPES,
rep = REP,
block = IBLOCK,
resp = CAN:GY,
by = ENV)
mgidi_di <-
mgidi(mod_env,
ideotype = c("l, l, h, h, h, h"),
weights = c(1,1,2,1,1,5), # remove to consider equal heigths
SI = 5,
verbose = FALSE)
plot(mgidi_di$data[[4]], radar = FALSE)
plot(mgidi_di$data[[4]], radar = FALSE) +
coord_flip()
?plot.mgidi
plot(mgidi_di$data[[4]],
radar = FALSE,
check.overlap = TRUE) +
coord_flip()
plot(mgidi_di$data[[4]],
radar = FALSE,
check.overlap = TRUE)
plot(mgidi_di$data[[4]],
# radar = FALSE,
check.overlap = TRUE)
?ggradar::ggradar()
mtcars_radar <-
mtcars %>%
as_tibble(rownames = "group") %>%
mutate_at(vars(-group), rescale) %>%
tail(4) %>%
select(1:10)
library(ggradar)
library(dplyr)
library(scales)
library(tibble)
mtcars_radar <-
mtcars %>%
as_tibble(rownames = "group") %>%
mutate_at(vars(-group), rescale) %>%
tail(4) %>%
select(1:10)
mtcars_radar
ggradar(mtcars_radar)
gens <- mgidi_di$data[[1]]$MGIDI
gens
gens <- mgidi_di$data[[1]]$MGIDI |> transpose_df()
gens
ggradar(gens)
ggradar(gens, grid.max = 600)
library(pliman)
?analyze_objects
library(pliman)
img <- image_pliman("soybean_touch.jpg")
obj <- analyze_objects(img)
obj$statistics
plot(img)
top <-
analyze_objects(img,
marker = "id",
topn_upper = 5,
show_segmentation = TRUE)
top <-
analyze_objects(img,
marker = "area",
# topn_upper = 5,
show_segmentation = TRUE)
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
show_segmentation = TRUE)
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
show_segmentation = TRUE,
col_background = "white")
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
show_segmentation = TRUE,
show_contour = FALSE,
col_background = "white")
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
show_segmentation = TRUE,
show_contour = FALSE,
filter = 30,
col_background = "white")
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
show_segmentation = TRUE,
show_contour = FALSE,
filter = 10,
col_background = "white")
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
show_segmentation = TRUE,
show_contour = FALSE,
filter = FALSE,
col_background = "white")
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
show_segmentation = TRUE,
show_contour = FALSE,
filter = 5,
col_background = "white")
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
show_segmentation = TRUE,
show_contour = FALSE,
filter = 4,
col_background = "white")
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
# show_segmentation = TRUE,
show_contour = FALSE,
filter = 4,
col_background = "white")
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
# show_segmentation = TRUE,
# show_contour = FALSE,
filter = 4,
col_background = "white")
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
# show_segmentation = TRUE,
# show_contour = FALSE,
filter = 4,
contour_size = 5,
col_background = "white")
top <-
analyze_objects(img,
marker = "id",
# topn_upper = 5,
# show_segmentation = TRUE,
# show_contour = FALSE,
filter = 4,
contour_size = 3,
col_background = "white")
# Chunk 1: global_options
knitr::opts_chunk$set(cache = TRUE,
comment = "##",
collapse = TRUE,
warning = FALSE,
message = FALSE)
# Chunk 2
library(EnvRtype)
library(rio)
library(ggh4x)
library(ggridges)
library(corrr)
library(tidyverse)
library(metan)
my_theme <-
theme_bw() +
theme(panel.spacing = unit(0, "cm"),
panel.grid = element_blank(),
legend.position = "bottom")
# Chunk 3
df_traits <-
import("https://bit.ly/df_barley") |>
as_factor(1:6)
# Chunk 5
env_data <- import("https://bit.ly/env_data_nasapower")
str(env_data)
id_var <- names(env_data)[10:19]
# Chunk 6
env_data |>
select_cols(id_var) |>
correlate() |>
network_plot() +
guides(color = guide_colorbar(barheight = 1,
barwidth = 20,
ticks.colour = "black")) +
theme(legend.position = "bottom")
ggsave("figs/fig1_network.png", width = 4, height = 4)
# Chunk 7
# long format for climate data
env_data_d <-
env_data |>
remove_cols(LON:YYYYMMDD, daysFromStart) |>
pivot_longer(-env)
# long format for grain yield
df_gy_dist <-
df_traits |>
select(YEARS, GY) |>
mutate(name = "GY", .after = YEARS) |>
rename(value = GY,
env = YEARS)
# Chunk 8
# bind climate and GY
env_data_d <- rbind(df_gy_dist, env_data_d)
# mean values for each trait
env_data_mean <- means_by(env_data_d, name)
ggplot(env_data_d, aes(x = value, y = env, fill = env)) +
geom_density_ridges(scale = 0.9) +
geom_vline(data = env_data_mean,
aes(xintercept = value),
linetype = 2) +
facet_grid(~name, scales = "free") +
theme(panel.grid.minor = element_blank(),
legend.position = "bottom",
legend.title = element_blank()) +
scale_y_discrete(expand = expansion(c(0, 0.05))) +
labs(x = "Observed value",
y = "Density",
fill = "") +
my_theme
ggsave("figs/fig2_density_climate.png", width = 12, height = 5)
# Chunk 9
names.window <- c('1-initial growing',
'2-Tillering',
'3-Boosting',
'4-Heading/Flowering',
"5-Grain filling",
"6-Physiological maturity")
out <-
env_typing(env.data = env_data,
env.id = "env",
var.id = c("trange", "tmax", "tmin", "dbp", "etp", "vpd"),
by.interval = TRUE,
time.window = c(0, 15, 35, 65, 90, 140),
names.window = names.window)
out2 <-
separate(out,
env.variable,
into = c("var", "freq"),
sep = "_",
extra = "drop")
# Chunk 10
# plot the distribution of envirotypes for dbp
p1 <-
out2 |>
subset(var == "tmin") |> # change the variable here
ggplot() +
geom_bar(aes(x=Freq, y=interval,fill=freq),
position = "fill",
stat = "identity",
width = 1,
color = "white",
size=.2)+
facet_grid(~env, scales = "free", space = "free")+
scale_y_discrete(expand = c(0,0))+
scale_x_continuous(expand = c(0,0))+
xlab('Relative frequency of the maximum temperature (ºC)')+
ylab("Crop stage")+
labs(fill='Envirotype')+
theme(axis.title = element_text(size=12),
legend.text = element_text(size=9),
strip.text = element_text(size=12),
legend.title = element_text(size=12),
strip.background = element_rect(fill="gray95",size=1),
legend.position = 'bottom')
# Chunk 11
# plot the distribution of envirotypes for dbp
p2 <-
out2 |>
subset(var == "vpd") |> # change the variable here
ggplot() +
geom_bar(aes(x=Freq, y=interval,fill=freq),
position = "fill",
stat = "identity",
width = 1,
color = "white",
size=.2)+
facet_grid(~env, scales = "free", space = "free")+
scale_y_discrete(expand = c(0,0))+
scale_x_continuous(expand = c(0,0))+
xlab(expression(Relative~frequency~of~the~vapor~pressure~deficit~~(KPa~day^{-1})))+
ylab("Environment")+
labs(fill='Envirotype')+
theme(axis.title = element_text(size=12),
legend.text = element_text(size=9),
strip.text = element_text(size=12),
legend.title = element_text(size=12),
strip.background = element_rect(fill="gray95",size=1),
legend.position = 'bottom')
# Chunk 12
# plot the distribution of envirotypes for dbp
p3 <-
out2 |>
subset(var == "dbp") |> # change the variable here
ggplot() +
geom_bar(aes(x=Freq, y=interval,fill=freq),
position = "fill",
stat = "identity",
width = 1,
color = "white",
size=.2)+
facet_grid(~env, scales = "free", space = "free")+
scale_y_discrete(expand = c(0,0))+
scale_x_continuous(expand = c(0,0))+
xlab(expression(Relative~frequency~of~the~rainfall~deficit~~(mm~day^{-1})))+
ylab("Environment")+
labs(fill='Envirotype')+
theme(axis.title = element_text(size=12),
legend.text = element_text(size=9),
strip.text = element_text(size=12),
legend.title = element_text(size=12),
strip.background = element_rect(fill="gray95",size=1),
legend.position = 'bottom')
arrange_ggplot(p1, p2, p3,
ncol = 1,
tag_levels = "a")
ggsave("figs/fig3_typology.png", width = 10, height = 9)
# Chunk 13
mod <-
gamem_met(df_traits,
env = ENV,
gen = GENOTYPES,
rep = REP,
block = IBLOCK,
resp = CAN:GY)
# Chunk 14
lrt <- gmd(mod, "lrt")
lrt
# Chunk 15
vcomp <- gmd(mod, "vcomp")
vcomp
plot(mod, type = "vcomp")
ggsave("figs/fig4_vcomp.png", width = 8, height = 7)
# Chunk 16
mod_env <-
gamem(df_traits,
gen = GENOTYPES,
rep = REP,
block = IBLOCK,
resp = CAN:GY,
by = ENV)
# Chunk 17
df_traits |>
select_numeric_cols() |>
correlate() |>
network_plot() +
guides(color = guide_colorbar(barheight = 1,
barwidth = 20,
ticks.colour = "black")) +
theme(legend.position = "bottom")
ggsave("figs/fig5_network_traits.png", width = 4, height = 4)
# Chunk 18
mgidi_di <-
mgidi(mod_env,
ideotype = c("l, l, h, h, h, h"),
weights = c(1,1,2,1,1,5), # remove to consider equal heigths
SI = 5,
verbose = FALSE)
sels <- sel_gen(mgidi_di) |> split_factors(ENV)
sel_2019DI <- sels$`2019DI`$data
sel_2019FI <- sels$`2019FI`$data
sel_2020DI <- sels$`2020DI`$data
sel_2020FI <- sels$`2020FI`$data
# Selected in DI
DI <- set_union(sel_2019DI, sel_2020DI)
# Selected in FI
FI <- set_union(sel_2019FI, sel_2020FI)
set_union(DI, FI)
set_intersect(DI, FI)
set_intersect(sel_2019DI, sel_2020DI, sel_2019FI, sel_2020FI)
set_intersect
set_helper
set_intersect(sel_2019DI, sel_2020DI, sel_2019FI, sel_2020FI, pairs = TRUE)
